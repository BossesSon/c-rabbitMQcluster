# RabbitMQ High-Performance Load Test Configuration
# Optimized for 150K messages/second at 100KB each (15GB RAM, 80GB storage)

# Management plugin with performance optimizations
management.tcp.port = 15672
management.tcp.ip = 0.0.0.0
management.rates_mode = none
management.sample_retention_policies.global.minute = 5
management.sample_retention_policies.global.hour = 60
management.sample_retention_policies.global.day = 1

# Multiple AMQP listeners for load balancing
listeners.tcp.1 = 0.0.0.0:5672
listeners.tcp.2 = 0.0.0.0:5673
listeners.tcp.3 = 0.0.0.0:5674
listeners.tcp.4 = 0.0.0.0:5675

# Clustering configuration
cluster_formation.peer_discovery_backend = classic_config
cluster_formation.classic_config.nodes.1 = rabbit@rmq1
cluster_formation.classic_config.nodes.2 = rabbit@rmq2
cluster_formation.classic_config.nodes.3 = rabbit@rmq3
cluster_formation.node_cleanup.interval = 30
cluster_formation.node_cleanup.only_log_warning = true

# Aggressive memory management for 15GB systems
vm_memory_high_watermark.relative = 0.7
vm_memory_high_watermark_paging_ratio = 0.8
disk_free_limit.absolute = 10GB

# Message store optimizations for extreme throughput
msg_store_file_size_limit = 268435456
msg_store_credit_disc_bound = 12000
queue_index_embed_msgs_below = 16384
queue_index_max_journal_entries = 262144

# TCP optimizations for 150K msg/s load
num_acceptors.tcp = 50
handshake_timeout = 5000
tcp_listen_options.backlog = 8192
tcp_listen_options.nodelay = true
tcp_listen_options.linger.on = true
tcp_listen_options.linger.timeout = 0
tcp_listen_options.sndbuf = 1048576
tcp_listen_options.recbuf = 1048576
tcp_listen_options.keepalive = true

# Channel optimizations
channel_max = 4096
channel_operation_timeout = 10000
max_message_size = 134217728

# Quorum queue optimizations for load test
default_queue_type = quorum
raft.segment_max_entries = 32768
raft.wal_max_size_bytes = 1073741824
raft.wal_max_batch_size = 8192
raft.snapshot_interval = 16384
raft.machine_version = 3

# Consumer optimizations
consumer_timeout = 1800000
consumer_prefetch_count = 1000

# Connection settings
heartbeat = 30
frame_max = 1048576

# Disable statistics during load test for performance
collect_statistics = none
collect_statistics_interval = 60000

# Background GC optimization
background_gc_enabled = true
background_gc_target_interval = 15000

# Queue optimizations
queue_master_locator = balanced
lazy_queue_explicit_gc_run_operation_threshold = 4000

# Logging optimization
log.console = true
log.console.level = warning
log.file = false

# Clustering optimizations
cluster_keepalive_interval = 10000
net_ticktime = 60