# RabbitMQ Configuration for 3-Node Cluster
# This configuration enables clustering with peer discovery and management interface

# Enable management plugin
management.tcp.port = 15672
management.tcp.ip = 0.0.0.0

# AMQP listeners
listeners.tcp.default = 5672

# Enable clustering
cluster_formation.peer_discovery_backend = classic_config

# Define cluster nodes (all three nodes)
cluster_formation.classic_config.nodes.1 = rabbit@rmq1
cluster_formation.classic_config.nodes.2 = rabbit@rmq2  
cluster_formation.classic_config.nodes.3 = rabbit@rmq3

# Clustering ports
cluster_formation.node_cleanup.interval = 10
cluster_formation.node_cleanup.only_log_warning = false

# Inter-node communication
distribution.buffer_size = 128000

# Enable quorum queues (default queue type)
default_queue_type = quorum

# Memory and disk thresholds
vm_memory_high_watermark.relative = 0.6
disk_free_limit.absolute = 1GB

# Enable log collection
log.console = true
log.console.level = info
log.file = false

# Heartbeat settings for better cluster stability
heartbeat = 60

# Connection limits
num_acceptors.tcp = 10

# Enable ra (raft algorithm) for quorum queues
raft.segment_max_entries = 65536
raft.wal_max_size_bytes = 104857600

# Consumer timeout
consumer_timeout = 900000

# Enable statistics
collect_statistics = coarse
collect_statistics_interval = 5000