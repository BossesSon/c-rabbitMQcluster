# RabbitMQ Configuration for 3-Node Cluster
# This configuration enables clustering with peer discovery and management interface

# Enable management plugin
management.tcp.port = 15672
management.tcp.ip = 0.0.0.0

# AMQP listeners
listeners.tcp.default = 5672

# Enable clustering
cluster_formation.peer_discovery_backend = classic_config

# Define cluster nodes (all three nodes)
cluster_formation.classic_config.nodes.1 = rabbit@rmq1
cluster_formation.classic_config.nodes.2 = rabbit@rmq2  
cluster_formation.classic_config.nodes.3 = rabbit@rmq3

# Clustering ports
cluster_formation.node_cleanup.interval = 10
cluster_formation.node_cleanup.only_log_warning = false

# Memory and disk thresholds - optimized for 15GB RAM
vm_memory_high_watermark.relative = 0.7
disk_free_limit.absolute = 5GB

# Enable log collection
log.console = true
log.console.level = info
log.file = false

# Heartbeat settings for better cluster stability
heartbeat = 60

# Connection limits - optimized for high load
num_acceptors.tcp = 30

# TCP buffer optimization (verified syntax)
tcp_listen_options.backlog = 4096
tcp_listen_options.nodelay = true
tcp_listen_options.linger.on = true
tcp_listen_options.linger.timeout = 0
tcp_listen_options.sndbuf = 196608
tcp_listen_options.recbuf = 196608

# Channel limits for high throughput
channel_max = 2048

# Consumer timeout
consumer_timeout = 900000

# Background GC optimization
background_gc_enabled = true
background_gc_target_interval = 30000