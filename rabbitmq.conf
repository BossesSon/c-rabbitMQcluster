# RabbitMQ Configuration for 3-Node Cluster
# Basic working configuration with performance optimizations

# Enable management plugin
management.tcp.port = 15672
management.tcp.ip = 0.0.0.0

# AMQP listeners
listeners.tcp.default = 5672

# Enable clustering
cluster_formation.peer_discovery_backend = classic_config

# Define cluster nodes (all three nodes)
cluster_formation.classic_config.nodes.1 = rabbit@rmq1
cluster_formation.classic_config.nodes.2 = rabbit@rmq2  
cluster_formation.classic_config.nodes.3 = rabbit@rmq3

# Clustering ports
cluster_formation.node_cleanup.interval = 10
cluster_formation.node_cleanup.only_log_warning = false

# Memory and disk thresholds - optimized for 15GB RAM
vm_memory_high_watermark.relative = 0.7
disk_free_limit.absolute = 5GB

# High throughput optimizations
msg_store_file_size_limit = 134217728
msg_store_credit_disc_bound = 8000
queue_index_embed_msgs_below = 8192

# Enable log collection
log.console = true
log.console.level = info
log.file = false

# Heartbeat settings for better cluster stability
heartbeat = 60

# Connection limits - optimized for high load
num_acceptors.tcp = 30
handshake_timeout = 10000

# TCP buffer optimization
tcp_listen_options.backlog = 4096
tcp_listen_options.nodelay = true
tcp_listen_options.linger.on = true
tcp_listen_options.linger.timeout = 0
tcp_listen_options.sndbuf = 196608
tcp_listen_options.recbuf = 196608

# Channel limits for high throughput
channel_max = 2048
channel_operation_timeout = 15000

# Consumer timeout
consumer_timeout = 900000

# Optimized statistics for high throughput
collect_statistics = basic
collect_statistics_interval = 10000

# Background GC optimization
background_gc_enabled = true
background_gc_target_interval = 30000