# RabbitMQ High-Performance Configuration for Load Testing
# Optimized for 150K messages/second at 100KB each (15GB RAM, 80GB storage)

# Management plugin
management.tcp.port = 15672
management.tcp.ip = 0.0.0.0

# AMQP listeners
listeners.tcp.default = 5672

# Enable clustering
cluster_formation.peer_discovery_backend = classic_config

# Define cluster nodes (all three nodes)
cluster_formation.classic_config.nodes.1 = rabbit@rmq1
cluster_formation.classic_config.nodes.2 = rabbit@rmq2
cluster_formation.classic_config.nodes.3 = rabbit@rmq3

# Clustering ports
cluster_formation.node_cleanup.interval = 10
cluster_formation.node_cleanup.only_log_warning = false

# Enable quorum queues (default queue type)
default_queue_type = quorum

# Memory and disk thresholds - optimized for 15GB RAM
vm_memory_high_watermark.relative = 0.7
vm_memory_high_watermark_paging_ratio = 0.8
disk_free_limit.absolute = 10GB

# High throughput optimizations
msg_store_file_size_limit = 268435456
msg_store_credit_disc_bound = 12000
queue_index_embed_msgs_below = 16384

# Enable log collection
log.console = true
log.console.level = info
log.file = false

# Heartbeat settings for better cluster stability
heartbeat = 60

# Connection limits - optimized for high load
num_acceptors.tcp = 50
handshake_timeout = 10000

# TCP buffer optimization
tcp_listen_options.backlog = 8192
tcp_listen_options.nodelay = true
tcp_listen_options.linger.on = true
tcp_listen_options.linger.timeout = 0
tcp_listen_options.sndbuf = 1048576
tcp_listen_options.recbuf = 1048576

# Raft optimizations for quorum queues under high load
raft.segment_max_entries = 32768
raft.wal_max_size_bytes = 268435456
raft.wal_max_batch_size = 4096
raft.snapshot_interval = 8192

# Channel limits for high throughput
channel_max = 4096
channel_operation_timeout = 15000

# Message store optimizations
queue_index_max_journal_entries = 65536

# Consumer timeout
consumer_timeout = 900000

# Optimized statistics for high throughput
collect_statistics = basic
collect_statistics_interval = 10000

# Background GC optimization
background_gc_enabled = true
background_gc_target_interval = 30000

# Queue optimizations
queue_master_locator = balanced